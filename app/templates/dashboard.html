{% extends "base.html" %} {% block content %}

<div class="page-header">
  <h2>{{ user.username }}'s Dashboard</h2>
  <p>
    Level {{ xp_info.level }} â€¢ {{ user.xp }} XP â€¢ {{ user.currency }} ðŸª™ coins
  </p>

  <div class="progress-bar">
    <div
      class="progress-bar-fill"
      data-percent="{{ xp_info['percent'] }}"
    ></div>
    <p class="progress-text">
      {{ xp_info['current_xp'] }} / {{ xp_info['needed_xp'] }} XP to next level
    </p>
  </div>

  <div class="card" style="margin-top: 16px">
    <h3>Today's Habit Completion</h3>
    <div class="progress-bar">
      <div
        class="progress-bar-fill"
        data-percent="{{ daily_info['percent'] }}"
      ></div>
    </div>
    <p class="progress-text">
      {{ daily_info['completed'] }} / {{ daily_info['total'] }} habits completed
      today
    </p>
  </div>

  <div class="page-actions">
    <a class="btn" href="{{ url_for('main.habits') }}">Manage Habits</a>
    <a class="btn" href="{{ url_for('shop.shop_home') }}">Shop</a>
  </div>

  <div class="card">
    <h3>Today's Habits</h3>

    {% if habit_data|length == 0 %}
    <p>No habits yet. Add one!</p>
    {% else %} {% for item in habit_data %}
    <div class="habit-item">
      <div>
        <strong>{{ item.habit.name }}</strong>
        <p class="muted">{{ item.habit.description }}</p>
        <p>Streak: {{ item.streak }} ðŸ”¥</p>
      </div>

      <div class="habit-actions">
        {% if item.completed_today %}
        <span class="badge badge-success">Completed âœ…</span>
        {% else %}
        <form
          method="POST"
          action="{{ url_for('main.complete_habit', habit_id=item.habit.id) }}"
        >
          <button type="submit" class="btn btn-primary">Mark Complete</button>
        </form>
        {% endif %}
      </div>
    </div>
    {% endfor %} {% endif %}
  </div>

  <div class="card">
    <h3>Habit Analytics (Last 7 Days)</h3>

    {% if analytics|length == 0 %}
    <p>No data yet. Complete some habits to see stats.</p>
    {% else %}
    <table class="stats-table">
      <thead>
        <tr>
          <th>Habit</th>
          <th>Streak</th>
          <th>7-Day Completions</th>
          <th>7-Day %</th>
          <th>Total Completions</th>
        </tr>
      </thead>
      <tbody>
        {% for row in analytics %}
        <tr>
          <td>{{ row.habit.name }}</td>
          <td>{{ row.streak }}</td>
          <td>{{ row.completed_last_7 }}</td>
          <td>{{ row.completion_rate_7 }}%</td>
          <td>{{ row.total_completions }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% endif %}
  </div>
</div>
{% endblock %}
